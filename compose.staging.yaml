# Staging overrides - use with --env-file env/env.staging
# Production builds with DEBUG logging and app-only port exposure
#
# Usage: docker compose --env-file env/env.staging up -d
#
# Staging configuration:
# - LOG_LEVEL: DEBUG (for troubleshooting)
# - restart: always (production-like behavior)
# - Frontend and API ports exposed (no infrastructure ports)
# - Production build targets (code baked into images)

services:
  api:
    build:
      target: production
    ports:
      - "${API_HOST_PORT:-8000}:8000"
    environment:
      LOG_LEVEL: DEBUG

  bot:
    build:
      target: production
    environment:
      LOG_LEVEL: DEBUG

  notification-daemon:
    build:
      target: production
    environment:
      LOG_LEVEL: DEBUG

  status-transition-daemon:
    build:
      target: production
    environment:
      LOG_LEVEL: DEBUG

  frontend:
    build:
      target: production
    ports:
      - "${FRONTEND_HOST_PORT:-3000}:80"
    environment:
      NGINX_LOG_LEVEL: debug

  postgres:
    command: [
      "postgres",
      "-c", "log_min_messages=debug1"
    ]

  rabbitmq:
    environment:
      RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS: -rabbit log_levels [{connection,debug}]

  redis:
    command: redis-server --appendonly yes --loglevel debug
