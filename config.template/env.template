# Discord Game Scheduler Environment Variables
# Copy this file to env.<environment> where <environment> can be: dev, prod, staging, e2e, or int
# Fill in appropriate values for your target environment

# ==========================================
# Docker Configuration
# ==========================================

# Which compose files to load (colon-separated list)
# Base file is always compose.yaml, others override/extend it
# Examples: compose.yaml:compose.override.yaml (dev), compose.yaml (prod), compose.yaml:compose.int.yaml (integration tests)
COMPOSE_FILE=compose.yaml:compose.override.yaml

# Conditional service activation (comma-separated list)
# Controls which services are started based on profile tags
# Examples: cloudflare (enables cloudflare tunnel), empty (no optional services)
COMPOSE_PROFILES=

# Docker registry URL prefix (include trailing slash)
# Examples: 172-16-1-24.xip.boneheads.us:5050/, docker.io/myorg/, empty for local
IMAGE_REGISTRY=dockerhub.boneheads.us:5050/

# Image tag for built containers (default: latest)
# Examples: latest, v1.0.0, dev, staging
IMAGE_TAG=latest

# Container name prefix for isolation (optional)
# Useful for running multiple instances on same host (e.g., staging)
# Examples: staging-, test-, empty (no prefix)
CONTAINER_PREFIX=

# Host workspace folder for development volume mounts
# Only used in development with compose.override.yaml
# Should be set to ${PWD} or absolute path to project root
HOST_WORKSPACE_FOLDER=${PWD}

# ==========================================
# Discord Bot Configuration
# ==========================================

# Discord bot authentication token
# Generate from Discord Developer Portal → Bot → Token
DISCORD_BOT_TOKEN=your_bot_token_here

# Discord OAuth2 application client ID
# Found in Discord Developer Portal → OAuth2 → Client ID
DISCORD_BOT_CLIENT_ID=your_client_id_here

# Discord OAuth2 application client secret
# Found in Discord Developer Portal → OAuth2 → Client Secret
DISCORD_BOT_CLIENT_SECRET=your_client_secret_here

# Bot service log verbosity
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
BOT_LOG_LEVEL=INFO

# ==========================================
# Database Configuration
# ==========================================

# PostgreSQL superuser for initial setup (bootstrap)
POSTGRES_USER=postgres

# PostgreSQL superuser password
# SECURITY: Change from default in production
POSTGRES_PASSWORD=dev_password_change_in_prod

# PostgreSQL database name
POSTGRES_DB=game_scheduler

# PostgreSQL admin user for migrations (superuser)
POSTGRES_ADMIN_USER=gamebot_admin

# PostgreSQL admin password
# SECURITY: Change from default in production
POSTGRES_ADMIN_PASSWORD=dev_admin_password_change_in_prod

# PostgreSQL application user for runtime (non-superuser with RLS)
POSTGRES_APP_USER=gamebot_app

# PostgreSQL application password
# SECURITY: Change from default in production
POSTGRES_APP_PASSWORD=dev_app_password_change_in_prod

# Full PostgreSQL connection URL for migrations (uses admin user)
# Format: postgresql+asyncpg://USER:PASSWORD@HOST:PORT/DATABASE
ADMIN_DATABASE_URL=postgresql+asyncpg://gamebot_admin:dev_admin_password_change_in_prod@postgres:5432/game_scheduler

# Full PostgreSQL connection URL for application services (uses app user for RLS enforcement)
# Format: postgresql+asyncpg://USER:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL=postgresql+asyncpg://gamebot_app:dev_app_password_change_in_prod@postgres:5432/game_scheduler

# PostgreSQL server log verbosity
# Options: debug5, debug4, debug3, debug2, debug1, info, notice, warning, error, log, fatal, panic
POSTGRES_LOG_LEVEL=info

# ==========================================
# RabbitMQ Configuration
# ==========================================

# RabbitMQ username
RABBITMQ_DEFAULT_USER=gamebot

# RabbitMQ password
# SECURITY: Change from default in production
RABBITMQ_DEFAULT_PASS=dev_password_change_in_prod

# Full RabbitMQ connection URL for application services
# Format: amqp://USER:PASSWORD@HOST:PORT/VHOST
RABBITMQ_URL=amqp://gamebot:dev_password_change_in_prod@rabbitmq:5672/

# RabbitMQ server log verbosity
# Options: debug, info, warning, error, critical, none
RABBITMQ_LOG_LEVEL=info

# ==========================================
# Redis Configuration
# ==========================================

# Full Redis connection URL
# Format: redis://HOST:PORT/DATABASE
REDIS_URL=redis://redis:6379/0

# Redis server log verbosity
# Options: debug, verbose, notice, warning, nothing
REDIS_LOG_LEVEL=verbose

# ==========================================
# API Configuration
# ==========================================

# JWT signing secret for authentication tokens
# SECURITY: Must be a strong random string in production
# Generate with: openssl rand -base64 32
JWT_SECRET=change_this_to_random_secret_in_prod

# API service log verbosity
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
API_LOG_LEVEL=INFO

# External API base URL for Discord embeds and OAuth redirects
# Used by bot for constructing callback URLs and links
# For local development: http://localhost:8000
# For production: Use your actual domain/IP
# Examples: https://example.com, http://192.168.1.100:8000
API_BASE_URL=

# ==========================================
# Frontend Configuration
# ==========================================

# Frontend URL for bot redirects and OAuth callbacks
# Used by API to construct redirect URLs after authentication
# Examples: http://localhost:3000, https://example.com
FRONTEND_URL=http://localhost:3000

# API endpoint URL for frontend to call
# Leave empty to use relative URLs (nginx proxy configuration)
# For separate API host, specify full URL
# Examples: http://localhost:8000, https://api.example.com, or empty for relative
API_URL=

# Nginx server log verbosity
# Options: debug, info, notice, warn, error, crit, alert, emerg
NGINX_LOG_LEVEL=info

# ==========================================
# Environment
# ==========================================

# Current deployment environment
# Options: development, staging, production
# Used for environment-specific behavior and logging
ENVIRONMENT=development

# Test environment flag (used only in test configurations)
# Set to true in env.e2e and env.int to enable test-specific behavior
# TEST_ENVIRONMENT=true

# ==========================================
# Daemon Service Configuration
# ==========================================

# Log verbosity for background daemon services
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# Notification daemon - sends Discord notifications for upcoming games
NOTIFICATION_DAEMON_LOG_LEVEL=INFO

# Status transition daemon - handles game state changes and participant promotions
STATUS_TRANSITION_DAEMON_LOG_LEVEL=INFO

# Retry daemon - retries failed operations
RETRY_DAEMON_LOG_LEVEL=INFO

# Retry daemon check interval in seconds
# How often to check dead-letter queues for failed messages to retry
# Default: 900 (15 minutes), Test environments: 5-15 (faster feedback)
RETRY_INTERVAL_SECONDS=900

# ==========================================
# OpenTelemetry / Grafana Cloud Configuration
# ==========================================
# See grafana-alloy/SETUP_GRAFANA_CLOUD.md for detailed instructions

# Grafana Cloud API Key (format: glc_xxxxx...)
# Generate from Security → API Keys with Metrics/Logs/Traces write permissions
# NOTE: Same API key works across all services
GRAFANA_CLOUD_API_KEY=glc_your_api_key_here

# OTLP Gateway Configuration (Application Telemetry)
# Used for: Application traces/metrics/logs via OTLP/HTTP protocol

# OTLP Gateway Instance ID (7-digit number from OTLP endpoint configuration)
# Location: Grafana Cloud → OTLP Endpoint → Copy → Decode the authorization header
GRAFANA_CLOUD_OTLP_INSTANCE_ID=

# OTLP Endpoint URL (WITH https:// prefix)
# Format: https://otlp-gateway-prod-{region}.grafana.net/otlp
# Example: https://otlp-gateway-prod-us-west-0.grafana.net/otlp
GRAFANA_CLOUD_OTLP_ENDPOINT=

# Prometheus Remote Write Configuration (Infrastructure Metrics)
# Used for: PostgreSQL/Redis/RabbitMQ metrics via Prometheus remote_write
# NOTE: Prometheus instance ID is DIFFERENT from OTLP instance ID!

# Prometheus Instance ID (7-digit number from Connections → Prometheus)
GRAFANA_CLOUD_PROMETHEUS_INSTANCE_ID=

# Prometheus Endpoint URL (WITH https:// prefix)
# Format: https://prometheus-prod-{number}-prod-{region}.grafana.net/api/prom/push
# Example: https://prometheus-prod-36-prod-us-west-0.grafana.net/api/prom/push
GRAFANA_CLOUD_PROMETHEUS_ENDPOINT=

# Loki Instance ID (for Alloy self-monitoring logs)
# Found in Grafana Cloud portal under Loki details
GRAFANA_CLOUD_LOKI_INSTANCE_ID=

# Loki Endpoint URL (WITH https:// prefix)
# Copy the exact URL from Grafana Cloud portal - may or may not include /loki/api/v1/push path
# Example: https://logs-prod-021.grafana.net/loki/api/v1/push
GRAFANA_CLOUD_LOKI_ENDPOINT=

# Alloy log verbosity
# Options: debug, info, warn, error
ALLOY_LOG_LEVEL=info

# Development-only host port mapping for Alloy UI
# Only used in development with compose.override.yaml
# Access Alloy UI at http://localhost:12345
ALLOY_HOST_PORT=12345

# ==========================================
# Cloudflare Tunnel Configuration
# ==========================================

# Cloudflare tunnel token for remote access
# Generate from Cloudflare Zero Trust dashboard
# Only needed when COMPOSE_PROFILES includes 'cloudflare'
CLOUDFLARE_TUNNEL_TOKEN=

# ==========================================
# Port Configuration (Development/Test Only)
# ==========================================
# See DOCKER_PORTS.md for detailed port exposure strategy
# Production deployments use reverse proxy - these variables are not used

# Application service ports (exposed in development and test only)
# API HTTP server port mapping
API_HOST_PORT=8000

# Frontend HTTP server port mapping
FRONTEND_HOST_PORT=3000

# Infrastructure service ports (development/test only)
# PostgreSQL server port mapping (use 'docker exec' in production)
POSTGRES_HOST_PORT=5432

# Redis server port mapping (use 'docker exec' in production)
REDIS_HOST_PORT=6379

# RabbitMQ AMQP protocol port mapping (use 'docker exec' in production)
RABBITMQ_HOST_PORT=5672

# Management UI ports (development only)
# RabbitMQ node clustering port mapping
RABBITMQ_DATA_HOST_PORT=25672

# RabbitMQ management UI port mapping (http://localhost:15672)
RABBITMQ_MGMT_HOST_PORT=15672

# ==========================================
# Test Only Variables
# ==========================================
# These variables are only used in test environments (integration and e2e)
# See config/env/env.int for integration tests, config/env/env.e2e for e2e tests

# Service connection details used by BOTH integration and e2e tests
# (used by test fixtures and init services)
# POSTGRES_HOST=postgres
# POSTGRES_PORT=5432
# RABBITMQ_HOST=rabbitmq
# RABBITMQ_PORT=5672
# ------------------------------------------

# Integration Test Only Variables
# Redis connection details (not used in e2e tests)
# REDIS_HOST=redis
# REDIS_PORT=6379

# Redis startup command for integration tests (disable persistence for speed)
# REDIS_COMMAND=valkey-server --appendonly no --save ""

# ------------------------------------------
# E2E Test Only Variables
# E2E Test Discord Configuration

# Regular User (member of Guild A only)
# DISCORD_USER_ID=

# Guild Configuration
# Guild A - primary test guild
# DISCORD_GUILD_A_ID=
# DISCORD_GUILD_A_CHANNEL_ID=

# Guild B - used for cross-guild isolation testing
# DISCORD_GUILD_B_ID=
# DISCORD_GUILD_B_CHANNEL_ID=

# Admin Bot A for E2E Testing (acts as authenticated admin user in tests for Guild A)
# This should be a separate bot application with admin permissions in Guild A
# DISCORD_ADMIN_BOT_A_TOKEN=
# DISCORD_ADMIN_BOT_A_INVITE_URL=
# DISCORD_ADMIN_BOT_A_CLIENT_ID=
# DISCORD_ADMIN_BOT_A_CLIENT_SECRET=

# Admin Bot B for E2E Testing (acts as authenticated admin user in tests for Guild B)
# This should be a separate bot application with admin permissions in Guild B
# Guild B is used for cross-guild isolation testing
# DISCORD_ADMIN_BOT_B_TOKEN=
# DISCORD_ADMIN_BOT_B_INVITE_URL=
# DISCORD_ADMIN_BOT_B_CLIENT_ID=
# DISCORD_ADMIN_BOT_B_CLIENT_SECRET=
